!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],r):r(n.V={},n.I,n.L)}(this,function(n,r,t){"use strict";function e(n){this.value=void 0!==n?n:null}function u(n){var r=Error(JSON.stringify(n,null,2));return r.errors=n,r}function i(n){throw u(n)}function o(n,r){var t=P;return t===M?t=r:P=M,n.of(h(t))}function c(n){n=t.toFunction(n);for(var e=arguments.length,u=C;--e;){var i=arguments[e];u=1!==f(i)?J(T(i[0]),N(i[1]),u):r.always(N(i[0]))}return function(r,e,i,o){return n(r,e,t.Constant,u)(r,e,i,o)}}var f=function(n){return n.length},a=r.curry(function(n,r){return n<=r}),s=r.curry(function(n,r){return r instanceof n}),l=s(Object),y=r.curry(function(n,r){return function(t){return n(r(t))}}),p=r.curry(function(n,r){return function(t){return n(t)&&r(t)}}),d=function(n){return Promise.resolve(n)},v=s(e),h=(0,r.id)(function(n){return new e(n)}),m=function(n){return n.value},A=function(n){return v(n)?m(n):void 0},w=function(n,r){return function(e){return t.any(v,n,e)?h(t.modify(n,r,e)):e}},g=t.rewrite(w(t.elems,function(n){return v(n)?m(n):null})),j=t.rewrite(w(t.elems,A)),O=t.rewrite(w(t.values,A)),I=function(n){return v(n)?i(u(m(n))):n},F=function(n,r,t){return function(){var e=arguments.length,u=n;if(e)for(u=r(arguments[--e],u);e;)u=t(arguments[--e],u);return u}},N=function(n){if(r.isFunction(n))return f(n)<3?Y(n):n;var t=n[1];return r.isFunction(t)?Z(t,n[0]):$(t,n[0])},b=function(n,r){return t.ifElse(n,E(r),_)},E=y(t.toFunction,t.modify(t.elems,N)),x=function(n){var e=n.less,u=n.rest;return u=N(u),function(){for(var n=arguments.length,i=Array(n),o=0;o<n;++o)i[o]=N(arguments[o]);return b(e?r.isArray:p(r.isArray,y(a(n),f)),[g,e?function(r,e,u,i){var o=f(r);return o<n?((r=r.slice()).length=n,u.map(function(n){return t.any(v,t.elems,n)?n:n.slice(0,o)},t.elemsTotal(r,e,u,i))):t.elemsTotal(r,e,u,i)}:t.elemsTotal,t.choose(function(n,r){return i[r]||u})])}},z=function(n,r,t){return B({Monad:n,onAccept:r,onReject:t})},M={},P=M,T=function(n,r){return function(t,e){try{return n(t,e)}catch(n){return P=n,r}}},q=t.zero,R=function(n){return function(r,t,e,u){return u(n,t)}},V=function(n){return function(r,t,e,u){return e.chain(function(n){return u(n,t)},n(r,t))}},W=y(t.setOp,h),_=t.modifyOp(h),k=R(void 0),C=r.always(_),J=function(n,r,t){return function(e,u){return function(i,c,f,a){return f.chain(function(n){return n?r(i,c,f,a):void 0!==n||P===M?t(e,u)(i,c,f,a):o(f,i)},n(e,u))}}},L=function(n){return r.curryN(2,function(r){return r=N(r),function(t){return t=N(t),n(r,t)}})},S=function(n){return function(r){return 3===f(r)?[r[0],tn(nn(r[1],r[2]),n)]:r}},B=r.curryN(3,function(n){var e=n.Monad||t.Identity,u=n.onAccept||r.id,o=n.onReject||i,c=function(n){return v(n)?o(m(n)):u(n)};return function(n){return n=N(n),function(u){return e.chain(c,t.traverse(e,r.id,n,u))}}}),D=z(0,r.always(!0),r.always(!1)),G=z(0,function(n){},r.id),H=z(),K=z(t.IdentityAsync,r.always(d(!0)),r.always(d(!1))),Q=z(t.IdentityAsync,r.always(d()),d),U=z(t.IdentityAsync,0,y(i,u)),X=z(t.IdentityAsync,d,y(function(n){return Promise.reject(n)},u)),Y=function(n){return n=T(n),function(r,t,e,u){return e.chain(function(n){return n?e.of(r):o(e,r)},n(r,t))}},Z=r.curry(function(n,r){return r=N(r),function(t,e,u,i){return u.chain(function(r){return v(r)?u.map(h,n(t,m(r),e)):u.of(r)},r(t,e,u,i))}}),$=r.curry(function(n,r){return E([t.rewrite(function(r){return v(r)?h(n):r}),r])}),nn=r.curryN(2,function(n){return y(tn(n),V)}),rn=r.curryN(2,function(n){return y(tn(n),R)}),tn=L(function(n,r){return function(t,e,u,i){return u.chain(function(n){return v(n)?u.of(n):r(n,e,u,i)},n(t,e,u,i))}}),en=F(q,N,tn),un=L(function(n,r){return function(t,e,u,i){return u.chain(function(n){return v(n)?r(t,e,u,i):u.of(n)},n(t,e,u,i))}}),on=F(_,N,un),cn=x({less:!0,rest:q}),fn=x({less:!1,rest:_}),an=r.curry(function(n,e){return n=N(n),function(o,c,f,a){return f.of(r.isFunction(o)?function(){for(var c=arguments.length,a=Array(c),s=0;s<c;s++)a[s]=arguments[s];return f.chain(function(n){return v(n)?i(u(m(n))):f.chain(function(u){return f.map(I,t.traverse(f,r.id,N(e.apply(null,n)),u))},o.apply(null,n))},t.traverse(f,r.id,n,a))}:h(o))}}),sn=r.curry(function(n,t){return an(n,r.always(t))}),ln=r.curry(function(n,r){return b(l,[t.setter(function(r,e){return v(r)?h(t.set(n,function(n,r,e){return void 0!==(r=t.get(n,r))?r:t.get(n,e)}(n,m(r),e),m(r))):r}),r])}),yn=r.curry(function(n,r){return b(l,[O,t.branchOr(N(n),t.modify(t.values,N,r))])}),pn=yn(_),dn=F(_,function(n,r){return 1===f(n)?n[0]:vn(n[0],n[1],r)},function(n,r){return vn(n[0],n[1],r)}),vn=r.curry(function(n,r,t){return n=T(n),r=N(r),t=N(t),function(e,u,i,c){return i.chain(function(n){return n?r(e,u,i,c):void 0!==n||P===M?t(e,u,i,c):o(i,e)},n(e,u))}}),hn=y(t.lazy,y(N)),mn=function(n){return n},An=mn(q),wn=mn(R),gn=mn(V),jn=mn(function(n){return function(r,t,e,u){return e.map(h,n(r,t))}}),On=mn(W),In=mn(_),Fn=mn(k),Nn=mn(B),bn=mn(D),En=mn(G),xn=mn(H),zn=mn(K),Mn=mn(Q),Pn=mn(U),Tn=mn(X),qn=mn(Y),Rn=mn(Z),Vn=mn($),Wn=mn(nn),_n=mn(rn),kn=mn(function(n){return tn(n,k)}),Cn=mn(tn),Jn=mn(en),Ln=mn(function(n){return E([t.setter(function(n,r){return v(n)?r:h(r)}),n])}),Sn=mn(un),Bn=mn(on),Dn=mn(function(n){return b(r.isArray,[j,t.elems,n])}),Gn=mn(function(n){return b(r.isArray,[g,t.elems,n])}),Hn=mn(cn),Kn=mn(fn),Qn=mn(an),Un=mn(sn),Xn=mn(ln),Yn=mn(function(n){return E([t.optional,n])}),Zn=mn(yn),$n=mn(pn),nr=mn(function(n){return n=T(n),function(r,t,e,u){return e.chain(function(n){return n?N(n)(r,t,e,u):o(e,r)},n(r,t))}}),rr=mn(dn),tr=mn(vn),er=mn(c),ur=mn(hn),ir=mn(function(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++)r[t]=arguments[t];return hn(function(n){return on.apply(null,r.map(function(r){return 2===f(r)?tn(nn(r[0],r[1]),n):r[0]}))})}),or=mn(function(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++)r[t]=arguments[t];return hn(function(n){return dn.apply(null,r.map(S(n)))})}),cr=mn(function(n){for(var r=arguments.length,t=Array(r>1?r-1:0),e=1;e<r;e++)t[e-1]=arguments[e];return hn(function(r){return c.apply(null,[n].concat(t.map(S(r))))})});n.accept=An,n.acceptAs=wn,n.acceptWith=gn,n.rejectWith=jn,n.rejectAs=On,n.reject=In,n.remove=Fn,n.run=Nn,n.accepts=bn,n.errors=En,n.validate=xn,n.acceptsAsync=zn,n.errorsAsync=Mn,n.tryValidateAsyncNow=Pn,n.validateAsync=Tn,n.where=qn,n.modifyError=Rn,n.setError=Vn,n.modifyAfter=Wn,n.setAfter=_n,n.removeAfter=kn,n.both=Cn,n.and=Jn,n.not=Ln,n.either=Sn,n.or=Bn,n.arrayId=Dn,n.arrayIx=Gn,n.args=Hn,n.tuple=Kn,n.dependentFn=Qn,n.freeFn=Un,n.keep=Xn,n.optional=Yn,n.propsOr=Zn,n.props=$n,n.choose=nr,n.cases=rr,n.ifElse=tr,n.casesOf=er,n.lazy=ur,n.promote=ir,n.upgrades=or,n.upgradesOf=cr,Object.defineProperty(n,"__esModule",{value:!0})});
