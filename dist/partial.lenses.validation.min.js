!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],r):r(n.V={},n.I,n.L)}(this,function(n,r,t){"use strict";var e=function(n){return n.length},u=r.curry(function(n,r){return n<=r}),i=r.curry(function(n,r){return r instanceof n}),o=i(Object),c=r.curry(function(n,r){return function(t){return n(r(t))}}),f=r.curry(function(n,r){return function(t){return n(t)&&r(t)}}),a=t.transform(function(n,r,t,e){return t},0),s=function(n){return Promise.resolve(n)},l=function(n){return null!=n&&"function"==typeof n.then},y={map:function(n,r){return l(r)?r.then(n):n(r)},ap:function(n,r){return l(r)||l(n)?Promise.all([n,r]).then(function(n){return n[0](n[1])}):n(r)},of:function(n){return n},chain:function(n,r){return l(r)?r.then(n):n(r)}},p={},d=function(n){return n===p?void 0:n},v=function(n){return void 0===n?p:n},h=t.rewrite(function(n){var r=j(n);return r&&(n=g(n)),n=n.map(d),r?w(n):n}),m=function(n,r,t,e){return t.map(v,e(n,r))};function A(n){this.value=void 0!==n?n:null}var j=i(A),w=r.id(function(n){return new A(n)}),g=function(n){return n.value},O=function(n){return j(n)?g(n):void 0},R=function(n,r){return function(e){return t.any(j,n,e)?w(t.modify(n,r,e)):e}},F=t.rewrite(R(t.elems,function(n){return j(n)?g(n):null})),M=t.rewrite(R(t.elems,O)),b=t.rewrite(R(t.values,O));function E(n){var r=Error(JSON.stringify(n,null,2));return r.errors=n,r}function x(n){throw E(n)}var P=function(n){return j(n)?x(E(g(n))):n},z=function(n,r,t){return function(){var e=arguments.length,u=n;if(e)for(u=r(arguments[--e],u);e;)u=t(arguments[--e],u);return u}},I=r.id(function(n){if(r.isFunction(n))return e(n)<3?U(n):n;var t=n[1];return r.isFunction(t)?X(t,n[0]):Y(t,n[0])}),N=t.modify(t.elems,I),q=function(n,r){return t.ifElse(n,V(r),Q)},V=c(t.toFunction,N),W=function(n){var i=n.less,o=n.rest;return o=I(o),function(){for(var n=[],a=arguments.length,s=0;s<a;++s)n.push(I(arguments[s]));return q(i?r.isArray:f(r.isArray,c(u(a),e)),[h,F,i?function(n,r,u,i){var o=e(n);return o<a?((n=n.slice()).length=a,u.map(function(n){return t.any(j,t.elems,n)?n:n.slice(0,o)},t.elems(n,r,u,i))):t.elems(n,r,u,i)}:t.elems,m,t.choose(function(r,t){return n[t]||o})])}},_=r.curryN(3,function(n){var e=n.Monad,u=n.onAccept,i=n.onReject;e=e||a,u=u||r.id,i=i||x;var o=function(n){return j(n)?i(g(n)):u(n)};return function(n){return n=I(n),function(u){return e.chain(o,t.traverse(e,r.id,n,u))}}}),k=_({onAccept:r.always(!0),onReject:r.always(!1)}),J=_({onAccept:function(n){},onReject:r.id}),L=_(r.object0),S=_({Monad:y,onAccept:r.always(s(!0)),onReject:r.always(s(!1))}),B=_({Monad:y,onAccept:r.always(s()),onReject:s}),C=_({Monad:y,onReject:c(x,E)}),D=_({Monad:y,onAccept:s,onReject:c(function(n){return Promise.reject(n)},E)}),G=t.zero,H=function(n){return function(r,t,e,u){return u(n,t)}},K=c(t.setOp,w),Q=t.modifyOp(w),T=H(void 0),U=function(n){return function(r,t,e,u){return e.chain(function(n){return n?r:w(r)},n(r,t))}},X=r.curry(function(n,r){return r=I(r),function(t,e,u,i){return u.chain(function(r){return j(r)?u.map(w,n(t,g(r),e)):r},r(t,e,u,i))}}),Y=r.curry(function(n,r){return V([t.rewrite(function(r){return j(r)?w(n):r}),r])}),Z=z(G,I,function(n,r){return n=I(n),function(t,e,u,i){return u.chain(function(n){return j(n)?u.of(n):r(n,e,u,i)},n(t,e,u,i))}}),$=z(Q,I,function(n,r){return n=I(n),function(t,e,u,i){return u.chain(function(n){return j(n)?r(t,e,u,i):u.of(n)},n(t,e,u,i))}}),nn=W({less:!0,rest:G}),rn=W({less:!1,rest:Q}),tn=r.curry(function(n,e){return n=I(n),function(u,i,o,c){return o.of(r.isFunction(u)?function(){for(var i=arguments.length,c=Array(i),f=0;f<i;f++)c[f]=arguments[f];return o.chain(function(n){return j(n)?x(E(g(n))):o.chain(function(u){return o.map(P,t.traverse(o,r.id,I(e.apply(null,n)),u))},u.apply(null,n))},t.traverse(o,r.id,n,c))}:w(u))}}),en=r.curry(function(n,t){return tn(n,r.always(t))}),un=r.curry(function(n,r){return q(o,[t.setter(function(r,e){return j(r)?w(t.set(n,function(n,r,e){return void 0===(r=t.get(n,r))?t.get(n,e):r}(n,g(r),e),g(r))):r}),r])}),on=r.curry(function(n,r){return q(o,[b,t.branchOr(I(n),t.modify(t.values,I,r))])}),cn=on(Q),fn=z(Q,r.id(function(n,r){return 1===e(n)?n[0]:an(n[0],n[1],r)}),r.id(function(n,r){return an(n[0],n[1],r)})),an=r.curry(function(n,r,t){return r=I(r),t=I(t),function(e,u,i,o){return i.chain(function(n){return n?r(e,u,i,o):t(e,u,i,o)},n(e,u))}}),sn=c(t.lazy,c(I));n.run=_,n.accepts=k,n.errors=J,n.validate=L,n.acceptsAsync=S,n.errorsAsync=B,n.tryValidateAsyncNow=C,n.validateAsync=D,n.accept=G,n.acceptAs=H,n.acceptWith=function(n){return function(r,t,e,u){return e.chain(function(n){return u(n,t)},n(r,t))}},n.rejectWith=function(n){return function(r,t,e,u){return e.map(w,n(r,t))}},n.rejectAs=K,n.reject=Q,n.remove=T,n.where=U,n.modifyError=X,n.setError=Y,n.and=Z,n.not=function(n){return V([t.setter(function(n,r){return j(n)?r:w(r)}),n])},n.or=$,n.arrayId=function(n){return q(r.isArray,[M,t.elems,n])},n.arrayIx=function(n){return q(r.isArray,[F,t.elems,n])},n.args=nn,n.tuple=rn,n.dependentFn=tn,n.freeFn=en,n.keep=un,n.optional=function(n){return V([t.optional,n])},n.propsOr=on,n.props=cn,n.cases=fn,n.ifElse=an,n.choose=function(n){return function(r,t,e,u){return e.chain(function(n){return I(n)(r,t,e,u)},n(r,t))}},n.lazy=sn,Object.defineProperty(n,"__esModule",{value:!0})});
